@page
@model EPC.WEB.Pages.Sales.HistoryModel
@using System.Globalization
@using EPC.Domain.Entities

@{
    ViewData["Title"] = "Your Sales History";
}

<h2 class="mb-4">Your Sales History</h2>

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <strong>Error:</strong> @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<form method="get" class="mb-4 card p-3 shadow-sm">
    <div class="row g-3">
        <div class="col-md-3">
            <label asp-for="StartDate" class="form-label">Start Date</label>
            <input asp-for="StartDate" type="date" class="form-control" />
        </div>
        <div class="col-md-3">
            <label asp-for="EndDate" class="form-label">End Date</label>
            <input asp-for="EndDate" type="date" class="form-control" />
        </div>

        <div class="col-md-3">
            <label asp-for="FilterCategoryId" class="form-label">Category</label>
            <select asp-for="FilterCategoryId" class="form-control">
                <option value="">All Categories</option>
                @foreach (var cat in Model.Categories)
                {
                    <option value="@cat.Id">@cat.Name</option>
                }
            </select>
        </div>

        <div class="col-md-3 d-flex align-items-end">
            <button type="submit" class="btn btn-outline-primary w-100">Apply Filters</button>
        </div>
    </div>
</form>
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card text-white bg-primary shadow-sm h-100">
            <div class="card-body">
                <h5 class="card-title">Total Sales (Filtered)</h5>
                <p class="card-text fs-3">@Model.TotalSales.ToString("C2", CultureInfo.CurrentCulture)</p>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card text-white bg-success shadow-sm h-100">
            <div class="card-body">
                <h5 class="card-title">Total Commission Earned</h5>
                <p class="card-text fs-3">@Model.TotalCommission.ToString("C2", CultureInfo.CurrentCulture)</p>
            </div>
        </div>
    </div>
</div>

@if (Model.Sales.Any())
{
    <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Category</th>
                    <th>SubCategory</th>
                    <th>Amount</th>
                    <th>Commission</th>
                    <th>Payment Type</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var s in Model.Sales)
                {
                    <tr>
                        <td>@s.Date.ToShortDateString()</td>
                        <td>@s.CategoryName</td>
                        <td>@s.SubCategoryName</td>
                        <td>@s.Amount.ToString("C2", CultureInfo.CurrentCulture)</td>
                        <td class="text-success">@s.CommissionEarned.ToString("C2", CultureInfo.CurrentCulture)</td>
                        <td>@s.PaymentType</td>
                        <td>
                            @if (!string.IsNullOrEmpty(s.TrackingNumber))
                            {
                                <small class="d-block text-muted">Track: @s.TrackingNumber</small>
                            }
                            @s.Description
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
else
{
    <div class="alert alert-info">No sales found matching your criteria. Try adjusting the dates or filters.</div>
}

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}